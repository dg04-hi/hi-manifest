apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: hiorder-main-ingress
  namespace: ns-hiorder
  annotations:
    # ê¸°ë³¸ Ingress ì„¤ì •
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    
    # SSL ì¸ì¦ì„œ ìë™ ë°œê¸‰ (cert-manager)
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    
    # íŒŒì¼ ì—…ë¡œë“œ ì„¤ì • (ë¦¬ë·° ì„œë¹„ìŠ¤ìš©)
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/client-max-body-size: "50m"
    
    # íƒ€ì„ì•„ì›ƒ ì„¤ì • (ì™¸ë¶€ API í˜¸ì¶œ ê³ ë ¤)
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    
    # Rate Limiting (v1.12.1 í˜¸í™˜)
    nginx.ingress.kubernetes.io/rate-limit-requests-per-second: "100"
    nginx.ingress.kubernetes.io/rate-limit-connections: "200"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
    
    # CORS ì„¤ì • (snippet ì—†ì´)
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
    nginx.ingress.kubernetes.io/cors-max-age: "86400"
    
    # ë°±ì—”ë“œ í”„ë¡œí† ì½œ ì„¤ì •
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    
    # í”„ë¡ì‹œ ì„¤ì •
    nginx.ingress.kubernetes.io/proxy-buffering: "on"
    nginx.ingress.kubernetes.io/proxy-buffer-size: "8k"
    
    # ì—…ìŠ¤íŠ¸ë¦¼ í•´ì‹œ ì„¤ì • (ì„¸ì…˜ ì–´í”¼ë‹ˆí‹°)
    nginx.ingress.kubernetes.io/upstream-hash-by: "$remote_addr"
    
spec:
  ingressClassName: nginx
  # tls:
  # - secretName: hiorder-api-tls-secret
  rules:
  # - host: hiorder-api.20.249.191.180.nio.io
  - http:
      paths:
      
      # ==============================================
      # ğŸ“± MEMBER SERVICE (íšŒì› ê´€ë¦¬) - Port 8081
      # ==============================================
      # ì¸ì¦ ê´€ë ¨ API (ìµœìš°ì„  ìˆœìœ„)
      - path: /api/auth
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      # íšŒì› ê´€ë¦¬ API
      - path: /api/members/ 
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      # êµ¬ë… ê´€ë¦¬ API
      - path: /api/subscriptions
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      # ==============================================
      # ğŸª STORE SERVICE (ë§¤ì¥ ìš´ì˜) - Port 8082
      # ==============================================
      # ë§¤ì¥ ê´€ë¦¬ API
      - path: /api/stores
        pathType: Prefix
        backend:
          service:
            name: store-service
            port:
              number: 8082
              
      # ë©”ë‰´ ê´€ë¦¬ API
      - path: /api/menus
        pathType: Prefix
        backend:
          service:
            name: store-service
            port:
              number: 8082
              
      # ì™¸ë¶€ í”Œë«í¼ ì—°ë™ API
      - path: /api/external
        pathType: Prefix
        backend:
          service:
            name: store-service
            port:
              number: 8082
              
      # ==============================================
      # ğŸ“ REVIEW SERVICE (ë¦¬ë·° ê´€ë¦¬) - Port 8083
      # ==============================================
      # ë¦¬ë·° ê´€ë¦¬ API
      - path: /api/reviews
        pathType: Prefix
        backend:
          service:
            name: review-service
            port:
              number: 8083
              
      # íŒŒì¼ ì—…ë¡œë“œ API (ì´ë¯¸ì§€ ì—…ë¡œë“œ)
      - path: /api/files
        pathType: Prefix
        backend:
          service:
            name: review-service
            port:
              number: 8083
              
      # ==============================================
      # ğŸ¤– ANALYTICS SERVICE (AI ë¶„ì„) - Port 8084
      # ==============================================
      # AI ë¶„ì„ API
      - path: /api/analytics
        pathType: Prefix
        backend:
          service:
            name: analytics-service
            port:
              number: 8084
              
      # ì‹¤í–‰ ê³„íš API
      - path: /api/action-plans
        pathType: Prefix
        backend:
          service:
            name: analytics-service
            port:
              number: 8084
              
      # ==============================================
      # ğŸ¯ RECOMMEND SERVICE (ì·¨í–¥ ì¶”ì²œ) - Port 8085
      # ==============================================
      # ì¶”ì²œ API
      - path: /api/recommend
        pathType: Prefix
        backend:
          service:
            name: recommend-service
            port:
              number: 8085
              
      # ==============================================
      # ğŸ“š SWAGGER UI & API DOCS (ê°œë°œì ë„êµ¬)
      # ==============================================
      # í†µí•© API ë¬¸ì„œ (member-service ê¸°ë³¸)
      - path: /docs
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      # ê° ì„œë¹„ìŠ¤ë³„ Swagger UI ì§ì ‘ ì ‘ê·¼
      - path: /docs/member
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      - path: /docs/store
        pathType: Prefix
        backend:
          service:
            name: store-service
            port:
              number: 8082
              
      - path: /docs/review
        pathType: Prefix
        backend:
          service:
            name: review-service
            port:
              number: 8083
              
      - path: /docs/analytics
        pathType: Prefix
        backend:
          service:
            name: analytics-service
            port:
              number: 8084
              
      - path: /docs/recommend
        pathType: Prefix
        backend:
          service:
            name: recommend-service
            port:
              number: 8085
              
      # ==============================================
      # ğŸ’Š HEALTH CHECKS & MONITORING
      # ==============================================
      # í†µí•© í—¬ìŠ¤ì²´í¬
      - path: /health
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      # Spring Boot Actuator
      - path: /actuator
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      # ê°œë³„ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ (í•„ìš”ì‹œ)
      - path: /health/member
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081
              
      - path: /health/store
        pathType: Prefix
        backend:
          service:
            name: store-service
            port:
              number: 8082
              
      - path: /health/review
        pathType: Prefix
        backend:
          service:
            name: review-service
            port:
              number: 8083
              
      - path: /health/analytics
        pathType: Prefix
        backend:
          service:
            name: analytics-service
            port:
              number: 8084
              
      - path: /health/recommend
        pathType: Prefix
        backend:
          service:
            name: recommend-service
            port:
              number: 8085
              
      # ==============================================
      # ğŸ  DEFAULT ROOT PATH
      # ==============================================
      # ê¸°ë³¸ ê²½ë¡œ (API ìƒíƒœ í™•ì¸)
      - path: /
        pathType: Prefix
        backend:
          service:
            name: member-service
            port:
              number: 8081